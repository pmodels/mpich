/* -*- Mode: C; c-basic-offset:4 ; -*- */
/*
 *  (C) 2009 by Argonne National Laboratory.
 *      See COPYRIGHT in top-level directory.
 */

#include "hydra.h"
#include "rmk.h"

/* *INDENT-OFF* */
static const char *rmk_names[] = { @hydra_rmk_names@ };
static int (*rmk_detect_fns[])(void) = { @hydra_rmk_detect_fns@ };
static HYD_status(*rmk_query_node_list_fns[])(struct HYD_node ** node_list) = { @hydra_rmk_query_node_list_fns@ };
/* *INDENT-ON* */

const char *HYDT_rmk_detect(void)
{
    const char *rmk = NULL;
    int i;

    HYDU_FUNC_ENTER();

    for (i = 0; rmk_names[i]; i++) {
        if ((*rmk_detect_fns[i]) ()) {
            rmk = rmk_names[i];
            break;
        }
    }

    HYDU_FUNC_EXIT();
    return rmk;
}

HYD_status HYDT_rmk_query_node_list(const char *rmk, struct HYD_node ** node_list)
{
    int i;
    HYD_status status = HYD_SUCCESS;

    HYDU_FUNC_ENTER();

    for (i = 0; rmk_names[i]; i++)
        if (!strcmp(rmk_names[i], rmk))
            break;

    if (rmk_names[i] == NULL)
        *node_list = NULL;
    else
        status = rmk_query_node_list_fns[i] (node_list);

  fn_exit:
    HYDU_FUNC_EXIT();
    return status;

  fn_fail:
    goto fn_exit;
}
