#include "coll_algo_params.h"
#include <mpidimpl.h>
#include "ch4_impl.h"

/* Traverses the container list to help serialize the collective containers. */
const void *MPIDI_coll_get_next_container(const void *container)
{
    return ((char *) container) + sizeof(MPIDIG_coll_algo_generic_container_t);
}

/* Compositions are presumed to be topology aware and the collective call can be composed into multiple calls
 * Each of these calls will access their corresponding containers (algorithms with parameters) by getting
 * the next element in the array of containers */

/* Barrier default composition containers initialization*/
const MPIDIG_coll_algo_generic_container_t MPIDI_Barrier_intra_composition_alpha_cnt[4] = {
    {.id = MPIDI_Barrier_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT},     /* node_barrier */
    {.id = MPIDI_COLL_AUTO_SELECT},     /* roots_barrier */
    {.id = MPIDI_COLL_AUTO_SELECT}      /* node_bcast */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Barrier_intra_composition_beta_cnt[2] = {
    {.id = MPIDI_Barrier_intra_composition_beta_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* barrier */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Barrier_inter_composition_alpha_cnt = {
    .id = MPIDI_Barrier_inter_composition_alpha_id
};

/* Bcast default composition containers initialization*/
const MPIDIG_coll_algo_generic_container_t MPIDI_Bcast_intra_composition_alpha_cnt[3] = {
    {.id = MPIDI_Bcast_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT},     /* roots bcast */
    {.id = MPIDI_COLL_AUTO_SELECT}      /* node bcast */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Bcast_intra_composition_beta_cnt[4] = {
    {.id = MPIDI_Bcast_intra_composition_beta_id},
    {.id = MPIDI_COLL_AUTO_SELECT},     /* node_bcast_first */
    {.id = MPIDI_COLL_AUTO_SELECT},     /* roots_bcast */
    {.id = MPIDI_COLL_AUTO_SELECT}      /* node_bcast_second */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Bcast_intra_composition_gamma_cnt[2] = {
    {.id = MPIDI_Bcast_intra_composition_gamma_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* bcast */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Bcast_inter_composition_alpha_cnt = {
    .id = MPIDI_Bcast_inter_composition_alpha_id
};

/* Reduce default composition containers initialization*/
const MPIDIG_coll_algo_generic_container_t MPIDI_Reduce_intra_composition_alpha_cnt[3] = {
    {.id = MPIDI_Reduce_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT},     /* roots_reduce */
    {.id = MPIDI_COLL_AUTO_SELECT}      /* node_reduce */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Reduce_intra_composition_beta_cnt[3] = {
    {.id = MPIDI_Reduce_intra_composition_beta_id},
    {.id = MPIDI_COLL_AUTO_SELECT},     /* roots_reduce */
    {.id = MPIDI_COLL_AUTO_SELECT}      /* node_reduce */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Reduce_intra_composition_gamma_cnt[2] = {
    {.id = MPIDI_Reduce_intra_composition_gamma_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* reduce */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Reduce_inter_composition_alpha_cnt = {
    .id = MPIDI_Reduce_inter_composition_alpha_id
};

/* Allreduce default composition containers initialization*/
const MPIDIG_coll_algo_generic_container_t MPIDI_Allreduce_intra_composition_alpha_cnt[4] = {
    {.id = MPIDI_Allreduce_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT},     /* node_reduce */
    {.id = MPIDI_COLL_AUTO_SELECT},     /* roots_allreduce */
    {.id = MPIDI_COLL_AUTO_SELECT}      /* node_bcast */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Allreduce_intra_composition_beta_cnt[2] = {
    {.id = MPIDI_Allreduce_intra_composition_beta_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /*allreduce */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Allreduce_intra_composition_gamma_cnt[2] = {
    {.id = MPIDI_Allreduce_intra_composition_gamma_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /*allreduce */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Allreduce_inter_composition_alpha_cnt = {
    .id = MPIDI_Allreduce_inter_composition_alpha_id
};

/* Gather default composition containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Gather_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Gather_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* gather */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Gather_inter_composition_alpha_cnt = {
    .id = MPIDI_Gather_inter_composition_alpha_id
};

/* Gatherv default composition containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Gatherv_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Gatherv_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* gatherv */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Gatherv_inter_composition_alpha_cnt = {
    .id = MPIDI_Gatherv_inter_composition_alpha_id
};

/* Scatter default composition containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Scatter_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Scatter_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* scatter */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Scatter_inter_composition_alpha_cnt = {
    .id = MPIDI_Scatter_inter_composition_alpha_id
};

/* Scatterv default composition containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Scatterv_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Scatterv_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* scatterv */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Scatterv_inter_composition_alpha_cnt = {
    .id = MPIDI_Scatterv_inter_composition_alpha_id
};

/* Alltoall default containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Alltoall_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Alltoall_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* alltoall */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Alltoall_inter_composition_alpha_cnt = {
    .id = MPIDI_Alltoall_inter_composition_alpha_id
};

/* Alltoallv default containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Alltoallv_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Alltoallv_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* alltoallv */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Alltoallv_inter_composition_alpha_cnt = {
    .id = MPIDI_Alltoallv_inter_composition_alpha_id
};

/* Alltoallw default containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Alltoallw_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Alltoallw_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* alltoallw */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Alltoallw_inter_composition_alpha_cnt = {
    .id = MPIDI_Alltoallw_inter_composition_alpha_id
};

/* Allgather default containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Allgather_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Allgather_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* allgather */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Allgather_inter_composition_alpha_cnt = {
    .id = MPIDI_Allgather_inter_composition_alpha_id
};

/* Allgatherv default containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Allgatherv_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Allgatherv_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* allgatherv */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Allgatherv_inter_composition_alpha_cnt = {
    .id = MPIDI_Allgatherv_inter_composition_alpha_id
};

/* Reduce_scatter default composition containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Reduce_scatter_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Reduce_scatter_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* reduce_scatter */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Reduce_scatter_inter_composition_alpha_cnt = {
    .id = MPIDI_Reduce_scatter_inter_composition_alpha_id
};

/* Reduce_scatter_block default composition containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Reduce_scatter_block_intra_composition_alpha_cnt[2]
    = {
    {.id = MPIDI_Reduce_scatter_block_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /*reduce_scatter_block */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Reduce_scatter_block_inter_composition_alpha_cnt = {
    .id = MPIDI_Reduce_scatter_block_inter_composition_alpha_id
};

/* Scan default containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Scan_intra_composition_alpha_cnt[4] = {
    {.id = MPIDI_Scan_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT},     /* node_scan */
    {.id = MPIDI_COLL_AUTO_SELECT},     /* roots_scan */
    {.id = MPIDI_COLL_AUTO_SELECT}      /* node_bcast */
};

const MPIDIG_coll_algo_generic_container_t MPIDI_Scan_intra_composition_beta_cnt[2] = {
    {.id = MPIDI_Scan_intra_composition_beta_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* scan */
};

/* Exscan default containers initialization */
const MPIDIG_coll_algo_generic_container_t MPIDI_Exscan_intra_composition_alpha_cnt[2] = {
    {.id = MPIDI_Exscan_intra_composition_alpha_id},
    {.id = MPIDI_COLL_AUTO_SELECT}      /* exscan */
};

/* Default containers initialization */
const MPIDIG_coll_algo_generic_container_t *MPIDI_Coll_intra_composition_default_container[] = {
    MPIDI_Allgather_intra_composition_alpha_cnt,
    MPIDI_Allgatherv_intra_composition_alpha_cnt,
    MPIDI_Allreduce_intra_composition_beta_cnt,
    MPIDI_Alltoall_intra_composition_alpha_cnt,
    MPIDI_Alltoallv_intra_composition_alpha_cnt,
    MPIDI_Alltoallw_intra_composition_alpha_cnt,
    MPIDI_Barrier_intra_composition_beta_cnt,
    MPIDI_Bcast_intra_composition_gamma_cnt,
    MPIDI_Exscan_intra_composition_alpha_cnt,
    MPIDI_Gather_intra_composition_alpha_cnt,
    MPIDI_Gatherv_intra_composition_alpha_cnt,
    MPIDI_Reduce_scatter_intra_composition_alpha_cnt,
    MPIDI_Reduce_scatter_block_intra_composition_alpha_cnt,
    MPIDI_Reduce_intra_composition_beta_cnt,
    MPIDI_Scan_intra_composition_alpha_cnt,
    MPIDI_Scatter_intra_composition_alpha_cnt,
    MPIDI_Scatterv_intra_composition_alpha_cnt,
    NULL,       /* iallgather default container */
    NULL,       /* iallgatherv default container */
    NULL,       /* iallreduce default container */
    NULL,       /* ialltoall default container */
    NULL,       /* ialltoallv default container */
    NULL,       /* ialltoallw default container */
    NULL,       /* ibarrier default container */
    NULL,       /* iexscan default container */
    NULL,       /* igather default container */
    NULL,       /* igatherv default container */
    NULL,       /* ireduce_scatter default container */
    NULL,       /* ireduce_scatter_block default container */
    NULL,       /* ireduce default container */
    NULL,       /* iscan default container */
    NULL,       /* iscatter default container */
    NULL,       /* iscatterv default container */
};

const MPIDIG_coll_algo_generic_container_t *MPIDI_Coll_inter_composition_default_container[] = {
    &MPIDI_Allgather_inter_composition_alpha_cnt,
    &MPIDI_Allgatherv_inter_composition_alpha_cnt,
    &MPIDI_Allreduce_inter_composition_alpha_cnt,
    &MPIDI_Alltoall_inter_composition_alpha_cnt,
    &MPIDI_Alltoallv_inter_composition_alpha_cnt,
    &MPIDI_Alltoallw_inter_composition_alpha_cnt,
    &MPIDI_Barrier_inter_composition_alpha_cnt,
    &MPIDI_Bcast_inter_composition_alpha_cnt,
    NULL,       /*Exscan default container */
    &MPIDI_Gather_inter_composition_alpha_cnt,
    &MPIDI_Gatherv_inter_composition_alpha_cnt,
    &MPIDI_Reduce_scatter_inter_composition_alpha_cnt,
    &MPIDI_Reduce_scatter_block_inter_composition_alpha_cnt,
    &MPIDI_Reduce_inter_composition_alpha_cnt,
    NULL,       /* Reduce default container */
    &MPIDI_Scatter_inter_composition_alpha_cnt,
    &MPIDI_Scatterv_inter_composition_alpha_cnt,
    NULL,       /* iallgather default container */
    NULL,       /* iallgatherv default container */
    NULL,       /* iallreduce default container */
    NULL,       /* ialltoall default container */
    NULL,       /* ialltoallv default container */
    NULL,       /* ialltoallw default container */
    NULL,       /* ibarrier default container */
    NULL,       /* iexscan default container */
    NULL,       /* igather default container */
    NULL,       /* igatherv default container */
    NULL,       /* ireduce_scatter default container */
    NULL,       /* ireduce_scatter_block default container */
    NULL,       /* ireduce default container */
    NULL,       /* iscan default container */
    NULL,       /* iscatter default container */
    NULL,       /* iscatterv default container */
};

/* *INDENT-OFF* */
@ch4_netmod_coll_globals_default@
#ifndef MPIDI_CH4_DIRECT_NETMOD
#include "../shm/posix/posix_coll_globals_default.c"
#endif
/* *INDENT-ON* */
